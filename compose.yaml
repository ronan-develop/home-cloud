version: '3.8'

services:
  php:
    image: php:8.3-fpm
    container_name: php
    volumes:
      - ./lenouvel.me/public:/var/www/html
    environment:
      DATABASE_URL: "postgresql://ron2cuba:root@127.0.0.1:5432/r_homecloud?serverVersion=16&charset=utf8"
    # Extensions à activer (exemple, à adapter selon besoin)
    build:
      context: .
      dockerfile: Dockerfile-php

  apache:
    image: httpd:alpine
    container_name: apache
    ports:
      - "80:80"
    volumes:
      - ./lenouvel.me/public:/usr/local/apache2/htdocs:ro
      - ./apache.conf:/usr/local/apache2/conf/httpd.conf:ro
    environment:
      - APACHE_RUN_USER=www-data
      - APACHE_RUN_GROUP=www-data
    depends_on:
      - php

# Pas de service database, utilisez la base externe
# Ajoutez un Dockerfile-php et un nginx.conf adaptés à votre projet

volumes:
  caddy_data:
  caddy_config:
  # database_data:
